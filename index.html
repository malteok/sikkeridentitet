<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sikker Identitet</title>
  <link rel="stylesheet" href="assets/styles.css">
  <link rel="stylesheet" href="assets/responsive.css">
</head>
<body class="index-landing">
  <div class="password-container" role="main">
    <h1>Sikker Identitet</h1>
    <input id="pw" type="password" placeholder="Adgangskode" autocomplete="off" inputmode="latin">
    <button id="go">Forts√¶t</button>
    <p id="err" class="error">Forkert adgangskode.</p>
  </div>

<script src="assets/auth.js"></script>
<script>
// SHA-256 hash of the correct password
const CORRECT_PASSWORD_HASH = "b9007ac17bf9d04561b51de189e84498ddc253c90486e3073a1c522e92105c7f";

async function hashPassword(password) {
  const encoder = new TextEncoder();
  const data = encoder.encode(password);
  const hashBuffer = await crypto.subtle.digest("SHA-256", data);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2, "0")).join("");
}

async function unlock() {
  const input = document.getElementById("pw");
  const err = document.getElementById("err");
  
  // Hide error message
  if (err) err.style.display = "none";
  
  const password = input ? input.value : "";
  const hash = await hashPassword(password);
  
  // Check if password is correct
  if (hash !== CORRECT_PASSWORD_HASH) {
    if (err) err.style.display = "block";
    return;
  }
  
  // Set authentication cookie
  try {
    if (window.SIAuth && SIAuth.setAuthCookie) {
      await SIAuth.setAuthCookie('unlocked');
    }
  } catch (e) {
    console.error('Failed to set auth cookie:', e);
  }
  
  // Redirect to forside.html
  location.href = 'forside.html';
}

// Event listeners
document.getElementById("go").addEventListener("click", unlock);
document.getElementById("pw").addEventListener("keypress", function(e) {
  if (e.key === "Enter") unlock();
});
</script>
</body>
</html>
